(function(a){function b(a,b){var c=parseFloat(a);this.value=isNaN(c)?a:c,this.units=b||""}function c(a,c){var d;c=c||{},this.type=a,this.defaultValue=c.defaultValue||0,d=(c.x||{}).units||(c.y||{}).units||(c.z||{}).units||c.units,this.units=typeof d!="undefined"?d:"px",this.x=new b(typeof c.x!="undefined"?c.x:this.defaultValue,this.units),this.y=new b(typeof c.y!="undefined"?c.y:this.defaultValue,this.units),this.z=new b(typeof c.z!="undefined"?c.z:this.defaultValue,this.units)}function e(a){a=a||{},a.scale=a.scale||{},a.scale.units="",a.scale.defaultValue=1,a.rotate=a.rotate||{},a.rotate.units="deg",this.translate=new c("translate",a.translate),this.rotate=new c("rotate",a.rotate),this.scale=new c("scale",a.scale)}function f(a,c){return function(d){var e="",f;if(typeof c=="undefined"||c)e=d[a+1]||undefined;return new b(d[a],e)}}function g(a,b){var c=a+"\\(";return(b||"").split(/\s/).forEach(function(a){c+=h[a]}),new RegExp(c+"\\)")}function k(a){var b=new e,d,f,g,h,k,l;for(d in j)j[d].forEach(function(e){l=a,f=e.regex.exec(l);while(f){g=g||{};if(typeof e.extract=="function")e.extract(f,g);else for(h in e)h!=="regex"&&typeof e[h]=="function"&&(g[h]=e[h](f));g.units=i[d],l=l.slice(0,f.index)+l.slice(f.index+f[0].length),e.multi?f=e.regex.exec(l):f=null}g&&(b[d]=new c(d,g),g=undefined)});return b}function l(a){if(typeof a=="string"||a instanceof String)return k(a)}b.prototype.valueOf=function(){return this.value},b.prototype.toString=function(){return this.value+this.units},b.prototype.matchingUnits=function(){var a=!0;for(var b=arguments.length;b--;)a=arguments[b].units===this.units;return a},c.prototype.add=function(a){var b=this.x.valueOf(),d=this.y.valueOf(),e=this.z.valueOf();if(typeof a=="number")b+=a,d+=a,e=e?e+a:0;else for(var f=arguments.length;f--;)b+=arguments[f].x||0,d+=arguments[f].y||0,e=e||arguments[f].z?e+(arguments[f].z||0):0;return new c(this.type,{x:b,y:d,z:e,units:this.units})},c.prototype.mul=function(a){var b=this.x.valueOf(),d=this.y.valueOf(),e=this.z?this.z.valueOf():0;if(typeof a=="number")b*=a,d*=a,e=typeof this.z!="undefined"?e*a:0;else for(var f=arguments.length;f--;)b*=arguments[f].x,d*=arguments[f].y,e*=arguments[f].z;return new c(this.type,{x:b,y:d,z:e,units:this.units})},["sub","div"].forEach(function(a){var b=a==="sub",d=b?"add":"mul";c.prototype[a]=function(a){if(typeof a=="number")return this[d](b?-a:1/a);var e=Array.prototype.map.call(arguments,function(a){var d=new c(this.type,a);return b?(d.x=-d.x,d.y=-d.y,d.z=-d.z):(d.x=1/d.x,d.y=1/d.y,d.z=d.z?1/d.z:0),d});return this[d].apply(this,e)}}),c.prototype.toString=function(a){var b=[];a=a||{};if(a.all||this.x.value!=this.defaultValue)b[b.length]=this.type+"X("+this.x.value+this.x.units+")";if(a.all||this.y.value!=this.defaultValue)b[b.length]=this.type+"Y("+this.y.value+this.y.units+")";if(a.all||this.z.value!=this.defaultValue)b[b.length]=this.type+"Z("+this.z.value+this.z.units+")";return b.join(" ")};var d={add:"mul",sub:"div"};e.prototype={clone:function(){return new e({translate:this.translate,scale:this.scale,rotate:this.rotate})},toString:function(a){var b=this.translate.toString(a),c=this.rotate.toString(a),d=this.scale.toString(a);return c&&(b+=(b?" ":"")+c),d&&(b+=(b?" ":"")+d),b}},["add","sub"].forEach(function(a){e.prototype[a]=function(){var b=new e;return b.translate=c.prototype[a].apply(this.translate,Array.prototype.map.call(arguments,function(a){return a.translate})),b.scale=c.prototype[d[a]].apply(this.scale,Array.prototype.map.call(arguments,function(a){return a.scale})),b.rotate=c.prototype[a].apply(this.rotate,Array.prototype.map.call(arguments,function(a){return a.rotate})),b}});var h={val:"(\\-?[\\d\\.]+)",unit:"([^\\s]*)",",":"\\,\\s*"},i={translate:"px",rotate:"deg",scale:""},j={translate:[{regex:g("translate","val unit , val unit"),x:f(1),y:f(3)},{regex:g("translate(X|Y|Z)","val unit"),extract:function(a,b){b[a[1].toLowerCase()]=f(2)(a)},multi:!0},{regex:g("translate","val unit , val unit , val unit"),x:f(1),y:f(3),z:f(5)}],rotate:[{regex:g("rotate","val unit"),z:f(1)},{regex:g("rotate(X|Y|Z)","val unit"),extract:function(a,b){b[a[1].toLowerCase()]=f(2)(a)},multi:!0}],scale:[{regex:g("scale","val"),x:f(1,!1),y:f(1,!1)},{regex:g("scale","val , val"),x:f(1,!1),y:f(2,!1)},{regex:g("scale(X|Y|Z)","val"),extract:function(a,b){b[a[1].toLowerCase()]=f(2,!1)(a)},multi:!0}]};l.fromString=k,l.Transform=e,l.XYZ=c,typeof module!="undefined"&&module.exports?module.exports=l:typeof define!="undefined"?define("ratchet",[],function(){return l}):a.ratchet=l})(this)